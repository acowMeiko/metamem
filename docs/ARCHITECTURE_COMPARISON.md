# MetaEvo æ¶æ„å¯¹æ¯”ï¼šæ—§ vs æ–°

## ğŸ“Š æ¶æ„æ¼”è¿›å›¾

### æ—§æ¶æ„ (metanew2 é£æ ¼)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      main.py                             â”‚
â”‚  (æ··åˆï¼šUIäº¤äº’ + æ•°æ®åŠ è½½ + æµç¨‹æ§åˆ¶)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  stage_first.py                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ - æ•°æ®é›†é€‚é… (preprocess_gsm8k, etc.)             â”‚  â”‚
â”‚  â”‚ - DPOç”Ÿæˆé€»è¾‘ (prepare_stage1)                    â”‚  â”‚
â”‚  â”‚ - Promptç¡¬ç¼–ç æ•£è½                                 â”‚  â”‚
â”‚  â”‚ - ç›´æ¥è°ƒç”¨æ¨¡å—å‡½æ•°                                 â”‚  â”‚
â”‚  â”‚ - æ–‡ä»¶I/Oæ··åœ¨ä¸šåŠ¡é€»è¾‘ä¸­                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              module/execute_module.py                    â”‚
â”‚              module/plan_module.py                       â”‚
â”‚  (æ··åˆï¼šPromptæ„å»º + æ¨¡å‹è°ƒç”¨ + æ‰¹å¤„ç†é€»è¾‘)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          inference/local_inference.py                    â”‚
â”‚          inference/api_inference.py                      â”‚
â”‚  (ç›´æ¥vLLM/APIè°ƒç”¨ï¼Œæ— ç»Ÿä¸€æ¥å£)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜ï¼š
âŒ èŒè´£ä¸æ¸…ï¼šæ•°æ®ã€é€»è¾‘ã€æ¨ç†æ··åœ¨ä¸€èµ·
âŒ ç´§è€¦åˆï¼šä¿®æ”¹ä¸€å¤„å½±å“å¤šå¤„
âŒ éš¾æ‰©å±•ï¼šæ·»åŠ æ–°æ•°æ®é›†/ç­–ç•¥éœ€è¦å¤§é‡æ”¹åŠ¨
âŒ éš¾æµ‹è¯•ï¼šæ— æ ‡å‡†æ¥å£ï¼Œä¾èµ–æ–‡ä»¶ç³»ç»Ÿ
```

---

### æ–°æ¶æ„ (memr3 é£æ ¼)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 run_experiments.py                       â”‚
â”‚  (çº¯é©±åŠ¨å™¨ï¼šè§£æå‚æ•° + ç»„è£…ç»„ä»¶ + æ‰§è¡Œæµç¨‹)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   core/config.py                         â”‚
â”‚  (é…ç½®ç®¡ç†ï¼šç¯å¢ƒå˜é‡ + éªŒè¯ + æ—¥å¿—è®¾ç½®)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ data/        â”‚  â”‚ inference/   â”‚  â”‚ templates/   â”‚
â”‚ processor.py â”‚  â”‚ engine.py    â”‚  â”‚ prompts.py   â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ æ•°æ®é¢„å¤„ç†    â”‚  â”‚ ç»Ÿä¸€æ¨ç†æ¥å£  â”‚  â”‚ Promptç®¡ç†   â”‚
â”‚ æ³¨å†Œè¡¨æ¨¡å¼    â”‚  â”‚ é€‚é…å™¨æ¨¡å¼    â”‚  â”‚ æ¨¡æ¿æ³¨å†Œ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   core/base.py                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  MetaAgentBase (æŠ½è±¡åŸºç±»)                         â”‚  â”‚
â”‚  â”‚  - process(input: ReasoningInput)                 â”‚  â”‚
â”‚  â”‚  - process_batch(inputs: List[ReasoningInput])    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ StageOne     â”‚  â”‚ StageTwo     â”‚  â”‚ Inference    â”‚
â”‚ Agent        â”‚  â”‚ Agent        â”‚  â”‚ Agent        â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ DPOæ•°æ®ç”Ÿæˆ   â”‚  â”‚ Memoryæ›´æ–°   â”‚  â”‚ æ¨ç†æ‰§è¡Œ     â”‚
â”‚ (ç­–ç•¥å®ç°)    â”‚  â”‚ (ç­–ç•¥å®ç°)    â”‚  â”‚ (ç­–ç•¥å®ç°)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜åŠ¿ï¼š
âœ… å•ä¸€èŒè´£ï¼šæ¯ä¸ªæ¨¡å—åŠŸèƒ½æ˜ç¡®
âœ… æ¾è€¦åˆï¼šé€šè¿‡æ¥å£äº¤äº’ï¼Œæ˜“äºæ›¿æ¢
âœ… æ˜“æ‰©å±•ï¼šæ³¨å†Œæ–°ç»„ä»¶ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒé€»è¾‘
âœ… æ˜“æµ‹è¯•ï¼šæ ‡å‡†æ¥å£ï¼Œå¯ mock
âœ… é…ç½®åŒ–ï¼šé›†ä¸­ç®¡ç†ï¼Œæ˜“äºè°ƒä¼˜
```

---

## ğŸ”„ æ•°æ®æµå¯¹æ¯”

### æ—§æ¶æ„æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥
  â”‚
  â–¼
main.py è¯»å–æ–‡ä»¶
  â”‚
  â–¼
stage_first.py
  â”‚ (å†…éƒ¨ç¡¬ç¼–ç è·¯å¾„)
  â”œâ”€ åŠ è½½æ•°æ®
  â”œâ”€ é¢„å¤„ç† (if/else åˆ¤æ–­æ•°æ®é›†ç±»å‹)
  â”œâ”€ è°ƒç”¨ execute_module.batch_answer_questions_directly()
  â”‚    â””â”€ å†…éƒ¨æ„å»º Prompt (ç¡¬ç¼–ç )
  â”‚    â””â”€ è°ƒç”¨ local_inference.batch_inference()
  â”œâ”€ è°ƒç”¨ plan_module.batch_generate_difference_list()
  â”‚    â””â”€ å†…éƒ¨æ„å»º Prompt (ç¡¬ç¼–ç )
  â”œâ”€ ...
  â””â”€ ç›´æ¥å†™æ–‡ä»¶
```

**é—®é¢˜**:
- æ•°æ®æ ¼å¼æ•£è½å„å¤„
- Prompt ç¡¬ç¼–ç 
- æ— æ³•ç‹¬ç«‹æµ‹è¯•æŸä¸ªç¯èŠ‚

---

### æ–°æ¶æ„æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥ (å‘½ä»¤è¡Œå‚æ•°)
  â”‚
  â–¼
run_experiments.py
  â”‚ (è§£æå‚æ•°)
  â–¼
DatasetProcessor.load_dataset()
  â”‚ (æ ‡å‡†åŒ–ä¸º {"question": str, "answer": str})
  â–¼
è½¬æ¢ä¸º ReasoningInput (æ ‡å‡†æ ¼å¼)
  â”‚
  â–¼
StageOneAgent.process_batch()
  â”‚
  â”œâ”€ PromptTemplate.get_task_description_prompt()
  â”‚    â””â”€ InferenceEngine.batch_inference()
  â”‚
  â”œâ”€ PromptTemplate.get_direct_answer_prompt()
  â”‚    â””â”€ InferenceEngine.batch_inference()
  â”‚
  â”œâ”€ PromptTemplate.get_diff_analysis_prompt()
  â”‚    â””â”€ InferenceEngine.batch_inference()
  â”‚
  â””â”€ ... (æ‰€æœ‰æ­¥éª¤éƒ½é€šè¿‡ç»Ÿä¸€æ¥å£)
  â”‚
  â–¼
è¿”å› List[ReasoningOutput] (æ ‡å‡†æ ¼å¼)
  â”‚
  â–¼
StageOneAgent.save_dpo_format()
  â”‚ (è´Ÿè´£æ–‡ä»¶I/Oçš„ç‹¬ç«‹æ–¹æ³•)
  â–¼
è¾“å‡ºæ–‡ä»¶
```

**ä¼˜åŠ¿**:
- æ•°æ®æ ¼å¼æ ‡å‡†åŒ– (`ReasoningInput` / `ReasoningOutput`)
- Prompt é›†ä¸­ç®¡ç†
- æ¯ä¸ªç¯èŠ‚å¯ç‹¬ç«‹æµ‹è¯•
- æ¸…æ™°çš„èŒè´£è¾¹ç•Œ

---

## ğŸ“¦ æ¨¡å—èŒè´£å¯¹æ¯”

| åŠŸèƒ½ | æ—§æ¶æ„ | æ–°æ¶æ„ | æ”¹è¿› |
|------|--------|--------|------|
| **æ•°æ®åŠ è½½** | `stage_first.py` å†…è” | `data/processor.py` | ç‹¬ç«‹æ¨¡å—ï¼Œæ³¨å†Œè¡¨æ¨¡å¼ |
| **æ•°æ®é¢„å¤„ç†** | å„å¤„ if/else | `DatasetProcessor` | ç»Ÿä¸€æ¥å£ï¼Œæ˜“æ‰©å±• |
| **Promptç®¡ç†** | æ•£è½åœ¨å„å¤„ | `templates/prompts.py` | é›†ä¸­ç®¡ç†ï¼Œæ— ç¡¬ç¼–ç  |
| **æ¨ç†è°ƒç”¨** | ç›´æ¥è°ƒ vLLM/API | `inference/engine.py` | ç»Ÿä¸€æ¥å£ï¼Œé€‚é…å™¨æ¨¡å¼ |
| **ä¸šåŠ¡é€»è¾‘** | `stage_first.py` å¤§å‡½æ•° | `core/stages.py` Agentç±» | ç­–ç•¥æ¨¡å¼ï¼Œæ¸…æ™°ç»“æ„ |
| **é…ç½®ç®¡ç†** | `config.py` å…¨å±€å˜é‡ | `core/config.py` ç±» | ç±»å‹å®‰å…¨ï¼ŒéªŒè¯æœºåˆ¶ |
| **ä¸»å…¥å£** | `main.py` äº¤äº’å¼ | `run_experiments.py` CLI | å‚æ•°åŒ–ï¼Œæ˜“è‡ªåŠ¨åŒ– |

---

## ğŸ¯ æ‰©å±•æ€§å¯¹æ¯”

### åœºæ™¯1: æ·»åŠ æ–°æ•°æ®é›†

**æ—§æ¶æ„**:
```python
# éœ€è¦ä¿®æ”¹ stage_first.py å¤šå¤„
def preprocess_new_dataset(raw_data):  # æ·»åŠ å‡½æ•°
    ...

DATASET_PREPROCESSORS = {
    ...,
    "new_dataset": preprocess_new_dataset  # æ³¨å†Œ
}

def load_and_preprocess_dataset(name, path):
    if name == "new_dataset":  # å¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç†
        ...
```

**æ–°æ¶æ„**:
```python
# åªéœ€åœ¨ data/processor.py æ·»åŠ ä¸€ä¸ªå‡½æ•°å¹¶æ³¨å†Œ
processor = DatasetProcessor()
processor.register('new_dataset', preprocess_new_dataset)
# å®Œæˆï¼æ— éœ€ä¿®æ”¹å…¶ä»–ä»£ç 
```

---

### åœºæ™¯2: ä¿®æ”¹ Prompt

**æ—§æ¶æ„**:
```python
# éœ€è¦åœ¨å¤šä¸ªæ–‡ä»¶ä¸­æœç´¢ç¡¬ç¼–ç çš„ Prompt
# module/execute_module.py
prompt = f"You are an expert...\n{question}"

# module/plan_module.py  
prompt = f"Analyze the difference...\n{question}"

# å®¹æ˜“æ¼æ”¹ï¼Œä¸ä¸€è‡´
```

**æ–°æ¶æ„**:
```python
# åªéœ€ä¿®æ”¹ templates/prompts.py ä¸€å¤„
class PromptTemplate:
    DIRECT_ANSWER_TEMPLATE = Template('...')  # ä¿®æ”¹è¿™é‡Œ
    
# æ‰€æœ‰è°ƒç”¨è‡ªåŠ¨æ›´æ–°
```

---

### åœºæ™¯3: åˆ‡æ¢æ¨ç†æ¨¡å‹

**æ—§æ¶æ„**:
```python
# éœ€è¦ä¿®æ”¹å¤šå¤„è°ƒç”¨
from inference.local_inference import batch_inference
results = batch_inference(prompts)  # ç¡¬ç¼–ç 

# åˆ‡æ¢åˆ° API éœ€è¦æ”¹ä»£ç 
from inference.api_inference import gpt_call
results = [gpt_call(p) for p in prompts]  # é€ä¸ªè°ƒç”¨
```

**æ–°æ¶æ„**:
```python
# åªéœ€ä¿®æ”¹é…ç½®
engine = (InferenceEngineBuilder()
          .set_weak_model('api', 'gpt-4', url='...', key='...')  # æ”¹è¿™é‡Œ
          .build())

# æ‰€æœ‰è°ƒç”¨è‡ªåŠ¨åˆ‡æ¢ï¼Œæ— éœ€æ”¹ä»£ç 
agent.process_batch(inputs)  # æ— éœ€ä¿®æ”¹
```

---

## ğŸ§ª å¯æµ‹è¯•æ€§å¯¹æ¯”

### æ—§æ¶æ„æµ‹è¯•å›°éš¾

```python
# éš¾ä»¥æµ‹è¯•ï¼Œå› ä¸ºä¾èµ–æ–‡ä»¶ç³»ç»Ÿå’Œå…¨å±€çŠ¶æ€
def test_prepare_stage1():
    # éœ€è¦å‡†å¤‡çœŸå®æ–‡ä»¶
    with open('test_data.json', 'w') as f:
        json.dump(test_data, f)
    
    # è°ƒç”¨æ—¶ä¼šè®¿é—®å…¨å±€ config
    prepare_stage1(dataset)
    
    # éœ€è¦è¯»å–è¾“å‡ºæ–‡ä»¶éªŒè¯
    with open('output/dpo_data.jsonl', 'r') as f:
        result = f.read()
    
    # æ¸…ç†æ–‡ä»¶
    os.remove('test_data.json')
```

---

### æ–°æ¶æ„æ˜“äºæµ‹è¯•

```python
# æ˜“äºæµ‹è¯•ï¼Œå› ä¸ºä½¿ç”¨æ ‡å‡†æ¥å£å’Œä¾èµ–æ³¨å…¥
def test_stage_one_agent():
    # Mock æ¨ç†å¼•æ“
    mock_engine = Mock(spec=InferenceEngine)
    mock_engine.batch_inference.return_value = ["answer1", "answer2"]
    
    # åˆ›å»º Agent (ä¾èµ–æ³¨å…¥)
    agent = StageOneAgent({
        'inference_engine': mock_engine,
        'prompt_template': PromptTemplate(),
        'batch_size': 2
    })
    
    # ä½¿ç”¨æ ‡å‡†è¾“å…¥
    inputs = [
        ReasoningInput(question="Q1", answer="A1"),
        ReasoningInput(question="Q2", answer="A2")
    ]
    
    # æ‰§è¡Œå¹¶éªŒè¯
    outputs = agent.process_batch(inputs)
    assert len(outputs) == 2
    assert mock_engine.batch_inference.called
```

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æ–¹é¢ | æ—§æ¶æ„ | æ–°æ¶æ„ | è¯´æ˜ |
|------|--------|--------|------|
| **æ‰¹å¤„ç†** | æ”¯æŒ (vLLM) | æ”¯æŒ (ä¼˜åŒ–) | æ–°æ¶æ„ç»Ÿä¸€äº†æ‰¹å¤„ç†æ¥å£ |
| **å¹¶å‘APIè°ƒç”¨** | æ‰‹åŠ¨å®ç° | å†…ç½®æ”¯æŒ | `InferenceEngine.concurrent_api_inference()` |
| **å†…å­˜ç®¡ç†** | æ‰‹åŠ¨ç®¡ç† | è‡ªåŠ¨ç®¡ç† | æ ‡å‡†è¾“å…¥è¾“å‡ºæ ¼å¼ï¼Œå‡å°‘å†—ä½™ |
| **ä»£ç é‡ç”¨** | ä½ (é‡å¤é€»è¾‘) | é«˜ (ç»„ä»¶åŒ–) | å‡å°‘é‡å¤ä»£ç  |

---

## ğŸ“ å­¦ä¹ æ›²çº¿

### æ—§æ¶æ„
- âœ… ç®€å•ï¼šå•æ–‡ä»¶ï¼Œçº¿æ€§æµç¨‹
- âŒ ä½†éš¾ä»¥ç»´æŠ¤ï¼šä¿®æ”¹å½±å“é¢å¤§
- âŒ éš¾ä»¥ç†è§£ï¼šèŒè´£æ··æ‚

### æ–°æ¶æ„
- âš ï¸ åˆæœŸï¼šéœ€è¦ç†è§£è®¾è®¡æ¨¡å¼
- âœ… é•¿æœŸï¼šæ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ
- âœ… æ˜“äºåä½œï¼šç‹¬ç«‹å¼€å‘å„æ¨¡å—

---

## ğŸš€ è¿ç§»è·¯å¾„

### æ¸è¿›å¼è¿ç§»ç­–ç•¥

```
é˜¶æ®µ1 (å®Œæˆ)
  â”œâ”€ åˆ›å»ºæ–°æ¶æ„éª¨æ¶
  â”œâ”€ å®ç°æ ¸å¿ƒæŠ½è±¡ç±»
  â””â”€ ä¿æŒæ—§ä»£ç å¯ç”¨

é˜¶æ®µ2 (å½“å‰)
  â”œâ”€ è¿ç§» Stage 1 åˆ°æ–°æ¶æ„
  â”œâ”€ è¿ç§» Stage 2 åˆ°æ–°æ¶æ„
  â””â”€ å¹¶è¡Œè¿è¡Œæ–°æ—§ä¸¤å¥—ä»£ç 

é˜¶æ®µ3 (æœªæ¥)
  â”œâ”€ åˆ‡æ¢ä¸»å…¥å£åˆ° run_experiments.py
  â”œâ”€ é€æ­¥åºŸå¼ƒæ—§æ¨¡å—
  â””â”€ ç§»é™¤æ—§ä»£ç 

é˜¶æ®µ4 (ä¼˜åŒ–)
  â”œâ”€ æ·»åŠ å•å…ƒæµ‹è¯•
  â”œâ”€ æ€§èƒ½ä¼˜åŒ–
  â””â”€ æ–‡æ¡£å®Œå–„
```

---

## ğŸ’¡ è®¾è®¡æ¨¡å¼åº”ç”¨æ€»ç»“

| è®¾è®¡æ¨¡å¼ | åº”ç”¨ä½ç½® | è§£å†³çš„é—®é¢˜ |
|---------|---------|-----------|
| **æŠ½è±¡åŸºç±»** | `core/base.py` | ç»Ÿä¸€æ¥å£ï¼Œä¿è¯ä¸€è‡´æ€§ |
| **ç­–ç•¥æ¨¡å¼** | `core/stages.py` | å¤šç§æ¨ç†ç­–ç•¥å¯åˆ‡æ¢ |
| **æ³¨å†Œè¡¨æ¨¡å¼** | `data/processor.py` | æ•°æ®é›†å¯æ‰©å±• |
| **é€‚é…å™¨æ¨¡å¼** | `inference/engine.py` | ç»Ÿä¸€ vLLM å’Œ API æ¥å£ |
| **æ¨¡æ¿æ–¹æ³•** | `core/base.py` | å®šä¹‰å¤„ç†æµç¨‹éª¨æ¶ |
| **ä¾èµ–æ³¨å…¥** | å„ Agent æ„é€ å‡½æ•° | è§£è€¦ï¼Œæ˜“æµ‹è¯• |
| **å•ä¾‹æ¨¡å¼** | `core/config.py` | å…¨å±€é…ç½®ç®¡ç† |

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- **é‡æ„æŒ‡å—**: `REFACTORING_GUIDE.md`
- **å¿«é€Ÿå¼€å§‹**: `examples/quick_start.py`
- **APIæ–‡æ¡£**: (å¾…è¡¥å……)
- **æµ‹è¯•ç”¨ä¾‹**: (å¾…è¡¥å……)

---

## ğŸ‰ æ€»ç»“

æ–°æ¶æ„åœ¨ä¿æŒåŠŸèƒ½ç­‰ä»·çš„å‰æä¸‹ï¼Œå®ç°äº†ï¼š

1. **æ›´å¥½çš„ç»„ç»‡**: æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ
2. **æ›´å¼ºçš„æ‰©å±•æ€§**: æ·»åŠ åŠŸèƒ½æ— éœ€æ”¹åŠ¨æ ¸å¿ƒ
3. **æ›´é«˜çš„å¯ç»´æŠ¤æ€§**: ä¿®æ”¹å½±å“èŒƒå›´å¯æ§
4. **æ›´å¥½çš„å¯æµ‹è¯•æ€§**: æ ‡å‡†æ¥å£ï¼Œæ˜“äº mock
5. **æ›´ä¼˜çš„åä½œ**: ç‹¬ç«‹å¼€å‘å„æ¨¡å—

**æ¨èä½¿ç”¨æ–°æ¶æ„è¿›è¡Œåç»­å¼€å‘ï¼**
